<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register as a Rental Partner - Transfers.ma</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        :root {
            --brand: #0d9488;
            --brand-dark: #0a7a70;
            --brand-light: #ccfbf1;
        }

        body {
            background-color: #f8fafb;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
        }

        .brand-header {
            background: linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%);
            color: #fff;
            padding: 2rem 0;
            text-align: center;
        }

        .brand-header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .brand-header p {
            opacity: 0.9;
            margin-bottom: 0;
            font-size: 1rem;
        }

        .progress-wrapper {
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            padding: 1.25rem 0;
        }

        .step-indicators {
            display: flex;
            justify-content: center;
            gap: 0;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 16px;
            left: -50%;
            width: 100%;
            height: 3px;
            background: #e5e7eb;
            z-index: -1;
        }

        .step-indicator:first-child::before {
            display: none;
        }

        .step-indicator.active::before,
        .step-indicator.completed::before {
            background: var(--brand);
        }

        .step-circle {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .step-indicator.active .step-circle {
            background: var(--brand);
            color: #fff;
            box-shadow: 0 0 0 4px var(--brand-light);
        }

        .step-indicator.completed .step-circle {
            background: var(--brand);
            color: #fff;
        }

        .step-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
        }

        .step-indicator.active .step-label,
        .step-indicator.completed .step-label {
            color: var(--brand);
            font-weight: 600;
        }

        .form-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 640px;
        }

        .step-section {
            display: none;
        }

        .step-section.active {
            display: block;
        }

        .step-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 0.25rem;
        }

        .step-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--brand);
            box-shadow: 0 0 0 0.2rem rgba(13, 148, 136, 0.15);
        }

        .btn-brand {
            background: var(--brand);
            border-color: var(--brand);
            color: #fff;
            font-weight: 600;
            padding: 0.625rem 1.5rem;
            border-radius: 8px;
        }

        .btn-brand:hover {
            background: var(--brand-dark);
            border-color: var(--brand-dark);
            color: #fff;
        }

        .btn-outline-secondary {
            font-weight: 600;
            padding: 0.625rem 1.5rem;
            border-radius: 8px;
        }

        .form-text {
            font-size: 0.8rem;
        }

        .invalid-feedback-custom {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: none;
        }

        .was-validated .invalid-feedback-custom {
            display: block;
        }

        .footer-link {
            text-align: center;
            padding: 1rem 0 2rem;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .footer-link a {
            color: var(--brand);
            font-weight: 600;
            text-decoration: none;
        }

        .footer-link a:hover {
            text-decoration: underline;
        }

        .alert {
            border-radius: 8px;
            max-width: 640px;
            margin: 1rem auto -1rem;
        }

        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: border-color 0.2s;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--brand);
        }

        .upload-area i {
            font-size: 2rem;
            color: #9ca3af;
        }

        .upload-area.has-file {
            border-color: var(--brand);
            background: var(--brand-light);
        }

        .upload-area.has-file i {
            color: var(--brand);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="brand-header">
        <div class="container">
            <h1>Join Transfers.ma as a Rental Partner</h1>
            <p>Register your company and start receiving bookings</p>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="progress-wrapper">
        <div class="container">
            <div class="step-indicators">
                <div class="step-indicator active" data-step="1">
                    <div class="step-circle">1</div>
                    <span class="step-label">Account</span>
                </div>
                <div class="step-indicator" data-step="2">
                    <div class="step-circle">2</div>
                    <span class="step-label">Company</span>
                </div>
                <div class="step-indicator" data-step="3">
                    <div class="step-circle">3</div>
                    <span class="step-label">Business</span>
                </div>
                <div class="step-indicator" data-step="4">
                    <div class="step-circle">4</div>
                    <span class="step-label">Documents</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages -->
    <div class="container">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- Registration Form -->
    <div class="container">
        <form id="registrationForm" action="" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            <div class="form-card">

                <!-- Step 1: Account Information -->
                <div class="step-section active" id="step-1">
                    <h2 class="step-title">Create Your Account</h2>
                    <p class="step-subtitle">Set up your personal login credentials.</p>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="first_name" class="form-label">First Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="last_name" class="form-label">Last Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                        </div>
                        <div class="col-12">
                            <label for="email" class="form-label">Email Address <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="email" name="email" required>
                            <div class="form-text">This will be your login email.</div>
                        </div>
                        <div class="col-12">
                            <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="phone" name="phone" placeholder="+212 6XX XXX XXX" required>
                        </div>
                        <div class="col-md-6">
                            <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="password" name="password" minlength="8" required>
                            <div class="form-text">Minimum 8 characters.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="password_confirm" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="password_confirm" name="password_confirm" minlength="8" required>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end mt-4">
                        <button type="button" class="btn btn-brand btn-next" data-next="2">
                            Next <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Company Information -->
                <div class="step-section" id="step-2">
                    <h2 class="step-title">Company Details</h2>
                    <p class="step-subtitle">Tell us about your rental company.</p>

                    <div class="row g-3">
                        <div class="col-12">
                            <label for="company_name" class="form-label">Company Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="company_name" name="company_name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="city" class="form-label">City <span class="text-danger">*</span></label>
                            <select class="form-select" id="city" name="city" required>
                                <option value="">Select a city</option>
                                <option value="Agadir">Agadir</option>
                                <option value="Casablanca">Casablanca</option>
                                <option value="Essaouira">Essaouira</option>
                                <option value="Fes">Fes</option>
                                <option value="Marrakech">Marrakech</option>
                                <option value="Meknes">Meknes</option>
                                <option value="Nador">Nador</option>
                                <option value="Oujda">Oujda</option>
                                <option value="Ouarzazate">Ouarzazate</option>
                                <option value="Rabat">Rabat</option>
                                <option value="Tangier">Tangier</option>
                                <option value="Tetouan">Tetouan</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="company_phone" class="form-label">Company Phone</label>
                            <input type="tel" class="form-control" id="company_phone" name="company_phone" placeholder="+212 5XX XXX XXX">
                        </div>
                        <div class="col-12">
                            <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="address" name="address" required>
                        </div>
                        <div class="col-12">
                            <label for="company_email" class="form-label">Company Email</label>
                            <input type="email" class="form-control" id="company_email" name="company_email">
                            <div class="form-text">Leave blank to use your account email.</div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-outline-secondary btn-prev" data-prev="1">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <button type="button" class="btn btn-brand btn-next" data-next="3">
                            Next <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Business Information -->
                <div class="step-section" id="step-3">
                    <h2 class="step-title">Business Information</h2>
                    <p class="step-subtitle">Provide your business registration details. These are optional but encouraged for faster approval.</p>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="ice_number" class="form-label">ICE Number</label>
                            <input type="text" class="form-control" id="ice_number" name="ice_number">
                            <div class="form-text">Identifiant Commun de l'Entreprise</div>
                        </div>
                        <div class="col-md-6">
                            <label for="rc_number" class="form-label">RC Number</label>
                            <input type="text" class="form-control" id="rc_number" name="rc_number">
                            <div class="form-text">Registre du Commerce</div>
                        </div>
                        <div class="col-md-6">
                            <label for="license_number" class="form-label">License Number</label>
                            <input type="text" class="form-control" id="license_number" name="license_number">
                            <div class="form-text">Rental activity license</div>
                        </div>
                        <div class="col-md-6">
                            <label for="tax_id" class="form-label">Tax ID</label>
                            <input type="text" class="form-control" id="tax_id" name="tax_id">
                            <div class="form-text">Identifiant Fiscal</div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-outline-secondary btn-prev" data-prev="2">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <button type="button" class="btn btn-brand btn-next" data-next="4">
                            Next <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Documents -->
                <div class="step-section" id="step-4">
                    <h2 class="step-title">Upload Documents</h2>
                    <p class="step-subtitle">Upload at least one document to verify your business. You can add more later.</p>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="document_type" class="form-label">Document Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="document_type" name="document_type" required>
                                <option value="">Select type</option>
                                <option value="business_license">Business License</option>
                                <option value="insurance">Insurance Certificate</option>
                                <option value="rc">Registre du Commerce</option>
                                <option value="ice">ICE Document</option>
                                <option value="tax_certificate">Tax Certificate</option>
                                <option value="id_card">ID Card / Passport</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="document_name" class="form-label">Document Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="document_name" name="document_name" placeholder="e.g. Business License 2025" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Document File <span class="text-danger">*</span></label>
                            <div class="upload-area" id="uploadArea">
                                <i class="bi bi-cloud-arrow-up d-block mb-2"></i>
                                <span class="upload-text text-muted">Click to select a file or drag and drop</span>
                                <div class="form-text mt-1">PDF, JPG, or PNG (max 10MB)</div>
                            </div>
                            <input type="file" class="d-none" id="document" name="document" accept=".pdf,.jpg,.jpeg,.png" required>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-outline-secondary btn-prev" data-prev="3">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <button type="submit" class="btn btn-brand" id="submitBtn">
                            <i class="bi bi-check-circle me-1"></i> Submit Registration
                        </button>
                    </div>
                </div>

            </div>
        </form>

        <div class="footer-link">
            Already have an account? <a href="{% url 'portal:login' %}">Login</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function () {
            'use strict';

            let currentStep = 1;
            const totalSteps = 4;

            const form = document.getElementById('registrationForm');
            const indicators = document.querySelectorAll('.step-indicator');

            // Show/hide step sections
            function showStep(step) {
                document.querySelectorAll('.step-section').forEach(function (section) {
                    section.classList.remove('active');
                });
                document.getElementById('step-' + step).classList.add('active');

                indicators.forEach(function (ind) {
                    const s = parseInt(ind.getAttribute('data-step'));
                    ind.classList.remove('active', 'completed');
                    if (s === step) {
                        ind.classList.add('active');
                    } else if (s < step) {
                        ind.classList.add('completed');
                        ind.querySelector('.step-circle').innerHTML = '<i class="bi bi-check"></i>';
                    } else {
                        ind.querySelector('.step-circle').textContent = s;
                    }
                });

                currentStep = step;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Validate required fields in a step section
            function validateStep(step) {
                const section = document.getElementById('step-' + step);
                const inputs = section.querySelectorAll('input[required], select[required]');
                let valid = true;

                inputs.forEach(function (input) {
                    input.classList.remove('is-invalid');

                    if (!input.value.trim()) {
                        input.classList.add('is-invalid');
                        valid = false;
                    }

                    // Email validation
                    if (input.type === 'email' && input.value.trim()) {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(input.value.trim())) {
                            input.classList.add('is-invalid');
                            valid = false;
                        }
                    }
                });

                // Step 1 specific: password match and length
                if (step === 1) {
                    const password = document.getElementById('password');
                    const confirm = document.getElementById('password_confirm');

                    if (password.value.length < 8) {
                        password.classList.add('is-invalid');
                        valid = false;
                    }

                    if (password.value !== confirm.value) {
                        confirm.classList.add('is-invalid');
                        valid = false;
                    }
                }

                // Step 4 specific: file required
                if (step === 4) {
                    const fileInput = document.getElementById('document');
                    const uploadArea = document.getElementById('uploadArea');
                    if (!fileInput.files.length) {
                        uploadArea.style.borderColor = '#dc3545';
                        valid = false;
                    } else {
                        uploadArea.style.borderColor = '';
                    }
                }

                return valid;
            }

            // Next buttons
            document.querySelectorAll('.btn-next').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    const nextStep = parseInt(this.getAttribute('data-next'));
                    if (validateStep(currentStep)) {
                        showStep(nextStep);
                    }
                });
            });

            // Previous buttons
            document.querySelectorAll('.btn-prev').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    const prevStep = parseInt(this.getAttribute('data-prev'));
                    showStep(prevStep);
                });
            });

            // Form submit validation
            form.addEventListener('submit', function (e) {
                if (!validateStep(4)) {
                    e.preventDefault();
                    return;
                }

                // Disable submit button to prevent double submission
                var submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span> Submitting...';
            });

            // File upload area
            var uploadArea = document.getElementById('uploadArea');
            var fileInput = document.getElementById('document');

            uploadArea.addEventListener('click', function () {
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', function (e) {
                e.preventDefault();
                this.style.borderColor = '#0d9488';
            });

            uploadArea.addEventListener('dragleave', function () {
                this.style.borderColor = '';
            });

            uploadArea.addEventListener('drop', function (e) {
                e.preventDefault();
                this.style.borderColor = '';
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    updateFileDisplay(e.dataTransfer.files[0]);
                }
            });

            fileInput.addEventListener('change', function () {
                if (this.files.length) {
                    updateFileDisplay(this.files[0]);
                }
            });

            function updateFileDisplay(file) {
                uploadArea.classList.add('has-file');
                var icon = uploadArea.querySelector('i');
                icon.className = 'bi bi-file-earmark-check d-block mb-2';
                uploadArea.querySelector('.upload-text').textContent = file.name;
                var helpText = uploadArea.querySelector('.form-text');
                if (helpText) {
                    helpText.textContent = formatFileSize(file.size);
                }
            }

            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / 1048576).toFixed(1) + ' MB';
            }

            // Remove invalid state on input
            document.querySelectorAll('.form-control, .form-select').forEach(function (input) {
                input.addEventListener('input', function () {
                    this.classList.remove('is-invalid');
                });
                input.addEventListener('change', function () {
                    this.classList.remove('is-invalid');
                });
            });
        })();
    </script>
</body>
</html>
